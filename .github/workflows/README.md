# üöÄ CI/CD Pipeline –¥–ª—è hakolr.dev

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–∞ VPS –ø—Ä–∏ –ø—É—à–µ –≤ –≤–µ—Ç–∫—É `main`.

## üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ SSH –∫–ª—é—á –¥–ª—è GitHub Actions

–ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π SSH –∫–ª—é—á —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –¥–µ–ø–ª–æ—è
ssh-keygen -t rsa -b 4096 -C "github-actions-deploy" -f ~/.ssh/github_actions_deploy

# –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ passphrase (–ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏—Ç–µ Enter)
```

### –®–∞–≥ 2: –î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ VPS

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
cat ~/.ssh/github_actions_deploy.pub

# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ VPS
ssh username@89.111.172.122

# –î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á –≤ authorized_keys
echo "–í–°–¢–ê–í–¨–¢–ï_–ü–£–ë–õ–ò–ß–ù–´–ô_–ö–õ–Æ–ß_–°–Æ–î–ê" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
ssh -i ~/.ssh/github_actions_deploy username@89.111.172.122
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ GitHub Secrets

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
2. Settings ‚Üí Secrets and variables ‚Üí Actions
3. –ù–∞–∂–º–∏—Ç–µ "New repository secret"

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ä–µ—Ç—ã:

#### `SSH_PRIVATE_KEY`
```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
cat ~/.ssh/github_actions_deploy
```
–í—Å—Ç–∞–≤—å—Ç–µ **–≤–µ—Å—å** –≤—ã–≤–æ–¥ (–≤–∫–ª—é—á–∞—è `-----BEGIN RSA PRIVATE KEY-----` –∏ `-----END RSA PRIVATE KEY-----`)

#### `SSH_HOST`
```
89.111.172.122
```

#### `SSH_USER`
```
username
```
(–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ VPS)

#### `PROJECT_PATH`
```
/home/username/hakolr.dev
```
(–∑–∞–º–µ–Ω–∏—Ç–µ `username` –Ω–∞ –≤–∞—à–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

#### `FRONTEND_URL`
```
https://hakolr.dev
```

---

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–µ–ø–ª–æ–π

–ü—Ä–∏ –ø—É—à–µ –≤ `main`:

1. ‚úÖ GitHub Actions –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ VPS –ø–æ SSH
2. ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ Git
3. ‚úÖ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
4. ‚úÖ –°–æ–±–∏—Ä–∞–µ—Ç –Ω–æ–≤—ã–µ Docker –æ–±—Ä–∞–∑—ã
5. ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–∞–π—Ç–∞

---

## üìä –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –¥–µ–ø–ª–æ—è

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
2. Actions ‚Üí Deploy to VPS
3. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π workflow run
4. –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞

---

## üéØ –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Actions
2. –í—ã–±–µ—Ä–∏—Ç–µ "Deploy to VPS"
3. –ù–∞–∂–º–∏—Ç–µ "Run workflow"
4. –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ç–∫—É `main`
5. –ù–∞–∂–º–∏—Ç–µ "Run workflow"

---

## üîß –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

–ü–µ—Ä–µ–¥ –ø—É—à–µ–º –≤ `main` —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏ Docker –æ–±—Ä–∞–∑–æ–≤
docker-compose -f docker-compose.prod.yml build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞
docker-compose -f docker-compose.prod.yml up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker-compose -f docker-compose.prod.yml logs

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose -f docker-compose.prod.yml down
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –∫–æ–¥–µ** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ GitHub Secrets
2. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏** –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
3. **–î–µ–ª–∞–π—Ç–µ backup –ë–î** –ø–µ—Ä–µ–¥ –∫—Ä—É–ø–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ—Ç–∫–∏** –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –¥–µ–ø–ª–æ–π—Ç–µ —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –∫–æ–¥

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ SSH –∫–ª—é—á –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ–ø–ª–æ—è
- ‚úÖ –ö–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ GitHub Secrets
- ‚úÖ –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- ‚úÖ –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞ VPS

---

## üÜò –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ "Permission denied (publickey)"

```bash
# –ù–∞ VPS –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω
cat ~/.ssh/authorized_keys
```

### –û—à–∏–±–∫–∞ "docker-compose: command not found"

```bash
# –ù–∞ VPS —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ docker-compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

### –î–µ–ø–ª–æ–π –∑–∞–≤–∏—Å

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ VPS –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ
ssh username@89.111.172.122
cd ~/hakolr.dev
docker-compose -f docker-compose.prod.yml logs
```

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- [ ] SSH –∫–ª—é—á —Å–æ–∑–¥–∞–Ω
- [ ] –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ VPS
- [ ] –í—Å–µ GitHub Secrets –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ
- [ ] –°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
- [ ] –õ–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã

---

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—É—à–µ –≤ `main` –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π! üéâ

